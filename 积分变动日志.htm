<!DOCTYPE html>
<html lang="zh-CN"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <title>积分变动日志</title>
    <link href="common/font-awesome.css" rel="stylesheet">
    <link href="common/plugin.css" rel="stylesheet">
    <link href="common/profit.css" rel="stylesheet">
    <link href="common/layer.css" type="text/css" rel="styleSheet" id="layermcss">

    <script type="text/javascript" src="common/jquery.js"></script>
    <script type="text/javascript" src="common/jquery_002.js"></script>
    <script type="text/javascript" src="common/json2.js"></script>
    <script type="text/javascript" src="common/loading.js"></script>
    <script type="text/javascript" src="common/layer.js"></script>
    <script type="text/javascript" src="common/emoji.js"></script>
    <script type="text/javascript" src="common/utils.js"></script>
    <script type="text/javascript" src="common/popodataime.js"></script><style id="shcl1" type="text/css">@-o-keyframes shcl1_bounce{0%{visibility:visible;-o-transform:scale(1)}80%{-o-transform:scale(.3)}100%{-o-transform:scale(1)}}@-ms-keyframes shcl1_bounce{0%{visibility:visible;-ms-transform:scale(1)}80%{-ms-transform:scale(.3)}100%{-ms-transform:scale(1)}}@-webkit-keyframes shcl1_bounce{0%{visibility:visible;-webkit-transform:scale(1)}80%{-webkit-transform:scale(.3)}100%{-webkit-transform:scale(1)}}@-moz-keyframes shcl1_bounce{0%{visibility:visible;-moz-transform:scale(1)}80%{-moz-transform:scale(.3)}100%{-moz-transform:scale(1)}}@keyframes shcl1_bounce{0%{visibility:visible;transform:scale(1)}80%{transform:scale(.3)}100%{transform:scale(1)}}</style></head><body><div class="hidden"><style>body,.popodatetime ul,.popodatetime p{margin:0;padding:0;-webkit-text-size-adjust:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}.popodatetime .hidden{display:none}.popodatetime{position:fixed;top:0;left:0;width:100%;height:100%;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:18px;color:#000;z-index:999999}.popodatetime .p-cover{position:absolute;height:100%;width:100%;background:rgba(0,0,0,.6);animation:fadeIn ease .2s both;-webkit-animation:fadeIn ease .2s both;z-index:0}.popodatetime .p-box{position:absolute;top:0;left:0;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:-webkit-flex;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;-webkit-align-items:center;align-items:center}.popodatetime .p-main{position:relative;margin:0 auto;padding:0 15px;max-width:400px;-webkit-box-flex:1;-webkit-flex:1;-ms-flex:1;flex:1;animation:fadeIn ease .2s both;-webkit-animation:fadeIn ease .2s both;z-index:1}.popodatetime.close .p-cover{animation:fadeOut ease .2s both;-webkit-animation:fadeOut ease .2s both}.popodatetime.close .p-main{animation:fadeOut ease .2s both;-webkit-animation:fadeOut ease .2s both}@-webkit-keyframes fadeIn{0%{opacity:0}100%{opacity:1}}@-webkit-keyframes fadeOut{0%{opacity:1}100%{opacity:0}}.popodatetime .p-main .p-scroll{position:relative;align-items:center;overflow:hidden}.popodatetime .p-main .p-scroll:before{content:"";position:absolute;z-index:0;top:50px;left:0;width:100%;height:50px;background:#f1f1f1;pointer-events:none}.popodatetime .p-main .p-scroll:after{position:absolute;left:0;top:0;width:200%;height:200%;content:"";border:solid 1px #ddd;transform:scale(.5);-webkit-transform:scale(.5);transform-origin:0 0;-webkit-transform-origin:0 0;pointer-events:none}.popodatetime .p-main .p-datetime{background:#fff;overflow:hidden;border-radius:3px;box-shadow:0 0 5px rgba(0,0,0,.3)}.popodatetime .p-main .p-result{text-align:center;height:50px;line-height:50px;box-shadow:0 0 10px rgba(0,0,0,.2)}.popodatetime .p-main .p-title{overflow:hidden}.popodatetime .p-main .p-title li{position:relative;width:20%;margin:10px 0;color:#999;text-align:center;list-style-type:none;float:left}.popodatetime .p-main .p-container{position:relative;z-index:1;width:20%;height:150px;float:left;overflow:hidden}.popodatetime .p-main .p-container:nth-child(4):after{position:absolute;left:0;top:0;width:1px;height:100%;content:"";border-right:solid 1px #ddd;-webkit-transform:scaleX(.5);transform:scaleX(.5)}.popodatetime .p-wrapper{-webkit-transition-timing-function:ease-out}.popodatetime .p-wrapper>div{text-align:center;height:50px;line-height:50px;font-family:"Arial";cursor:pointer}.popodatetime .p-button{position:relative;line-height:42px;font-size:18px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}.popodatetime .p-button:after{content:"";position:absolute;left:0;top:0;width:100%;height:1px;border-top:1px solid #d5d5d6;color:#d5d5d6;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:scaleY(0.5);transform:scaleY(0.5)}.popodatetime .p-button a{position:relative;display:block;-webkit-box-flex:1;-webkit-flex:1;-ms-flex:1;flex:1;text-align:center;color:#000;text-decoration:none}.popodatetime .p-button a.confirm{color:#10aeff;}.popodatetime .p-button a.clear{color:#E64340;}.popodatetime .p-button a:after{content:" ";position:absolute;left:0;top:0;width:1px;height:100%;border-left:1px solid #d5d5d6;color:#d5d5d6;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:scaleX(0.5);transform:scaleX(0.5)}.popodatetime .p-main.onlydate .p-title li,.popodatetime .p-main.onlydate .p-container{width:33.333333%}.popodatetime .p-main.onlytime .p-title li,.popodatetime .p-main.onlytime .p-container{width:50%}.popodatetime .p-main.onlyhour .p-title li,.popodatetime .p-main.onlyhour .p-container{width:25%}.popodatetime .p-top .p-main,.popodatetime .p-bottom .p-main{position:absolute;top:0;left:0;margin:0;padding:0;width:100%;border-radius:0}.popodatetime .p-bottom .p-main{top:auto;bottom:0}.popodatetime .p-inline .p-main{margin:0;padding:0}.</style></div>


<div class="content profit log">
    <header>
        <div class="top-tit">日志</div>
    </header>
    <div class="tab parts">
        <div class="p-flex-box">
            <div>
                <div class="head-img" id="divHeadImg" style="background-size: cover;"></div>
                <div class="face" id="divNick">林羽然</div>
            </div>
            <div class="p1"><a id="labMoney">当前12408积分</a></div>
            <div class="right">
                <div class="timer">
                    <input class="inp" readonly="readonly" placeholder="全部类型" type="text">
                    <i class="fa fa-caret-down"></i>
                </div>
                <select id="drpBusinessType">
                    <option value="0" selected="selected">全部类型</option>
                <option value="10">充值</option><option value="11">上庄</option><option value="12">下注</option><option value="13">服务费</option><option value="14">代包费</option><option value="15">抽水</option><option value="16">开奖</option><option value="17">提现</option><option value="18">兑换</option><option value="19">上分</option><option value="20">下分</option><option value="21">金币奖励</option><option value="22">多号绑定</option><option value="23">回滚调整</option><option value="24">回滚</option><option value="25">金币处罚</option><option value="26">积分奖励</option><option value="27">积分处罚</option><option value="28">无押注罚</option></select>
            </div>
        </div>
        <table class="p-tb">
            <thead>
            <tr>
                <td>时间</td>
                <td>明细</td>
                <td>变动类型</td>
                <td>变动前余额</td>
                <td>变动后余额</td>
            </tr>
            </thead>
            <tbody id="divList">/tbody>
        </table>
    </div>
</div>

<script>
    $(function () {

        $(".parts select").change(function () {
            var optionText = $(this).find('option:checked').text();
            $(this).siblings('.timer').find('.inp').val(optionText);
            Search();
        })

    })


    var nUserId = Request.QueryString("nUserId");

    window.g = {
        pageIndex: 1,
        pageSize: 20,
        isloading: false,
        isloadend: false
    };

    /** 加载列表 **/
    function LoadList() {

        if (g.isloading || g.isloadend) {
            return;
        }


        /** 正在加载 **/
        g.isloading = true;
        loading.show();
        post("/api/mchinterface.asmx/FundDetail", { nPageIndex: g.pageIndex, nPageSize: g.pageSize, nUserId: nUserId, nBusinessType: $("#drpBusinessType").val(), vcStartDate: "", vcEndDate: "" }, function (ds) {
            loading.hide();
            g.isloading = false;

            var dt = ds[0];

            var s = '';
            for (var i = 0; i < dt.length; i++) {

                var dr = dt[i];

                s += '<tr>';
                s += '    <td>'+ dr.dtCreateTime +'</td>';
                s += '    <td class="' + (parseInt(dr.dmChangeMoney) > 0 ? 'red' : 'green') + '">' + (parseInt(dr.dmChangeMoney) > 0 ? '+' : '') + dr.dmChangeMoney + '</td>';
                s += '    <td>' + dr.vcBusinessType+ '</td>';
                s += '    <td>'+ dr.dmPreMoney +'</td>';
                s += '    <td>' + dr.dmCurrentMoney + '</td>';
                s += '</tr>';

            }

            $("#divList").append(s);

            $("#divHeadImg").css("background-image", "url(" + ds[1][0].vcHeadImgUrl + ")");
            $("#divNick").html(ds[1][0].vcBetNickName == "" ? ReplaceBase64Img(ds[1][0].vcBase64WeixinName) : ds[1][0].vcBetNickName);
            $("#labMoney").html("当前" + parseInt(ds[1][0].dmMoney) + "积分");

            var recordCount = parseInt(ds[1][0].nRecordCount);
            var pageCount = parseInt((recordCount + g.pageSize - 1) / g.pageSize);
            if (g.pageIndex == pageCount) {
                g.isloadend = true;
            }
            else {
                g.pageIndex = g.pageIndex + 1;
            }

            if ($("#drpBusinessType")[0].options.length == 1) {

                var s = '';
                var dt = ds[2];
                for (var i = 0; i < dt.length; i++) {
                    var dr = dt[i];
                    s += '<option value="' + dr.nKeyId + '">' + dr.vcKeyName + '</option>';
                }
                $("#drpBusinessType").append(s);

            }

        }, "text");

    }

    /** 初始化滚屏加载 **/
    $(window).scroll(function () {
        if (g.isloading || g.isloadend) return;
        if (document.documentElement.clientHeight + document.body.scrollTop - document.body.scrollHeight >= -55) {
            LoadList();
        }
    });

    LoadList();

    function Search() {
        window.g = {
            pageIndex: 1,
            pageSize: 20,
            isloading: false,
            isloadend: false
        };
        $("#divList").html("");
        LoadList();
    }
</script>
</body></html>